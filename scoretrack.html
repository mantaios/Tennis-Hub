<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î–Ï‰Î½Ï„Î±Î½ÏŒÏ‚ Î‘Î³ÏÎ½Î±Ï‚ Î¤Î­Î½Î¹Ï‚ - Î”Î¹Î¿ÏÎ¸Ï‰Î¼Î­Î½Î¿</title>
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
    }

    #tournamentInfo {
      text-align: center;
      margin-bottom: 50px;
     
    }

    #courtImage {
      width: 90%;
      max-width: 800px;
      height: 400px;
      margin: 0 auto;
      border-radius: 20px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 20px #000;
    }

    .scoreboard {
      display: inline-block;
      background: white;
      border-radius: 16px;
      padding: 20px 0 20px 20px;
      box-shadow: 0 0 16px #000;
      font-family: Arial, sans-serif;
      width: auto;
      max-width: 850px;
      margin: 50px auto 0;
      font-size: 1.5rem;
      margin-left: 5%;
      padding-right: 50px;
    }

    .scores-wrapper {
      display: flex;
      align-items: center;
      gap: 0;
      width: calc(var(--numSets) * 42px + 70px + 12px);
      min-width: fit-content;
    }

    .scoreboard-row {
      display: flex;
      align-items: center;
      margin: 12px 24px;
      justify-content: flex-start;
      gap: 0;
      position: relative;
    }

    .player-name {
      background-color: #006400;
      color: white;
      padding: 14px 22px;
      min-width: 200px;
      position: relative;
      font-weight: bold;
      font-size: 1.6rem;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 250px;
      margin-right: 8px;
    }

    .sets-container {
      display: flex;
      gap: 0;
      flex-grow: 0;
      justify-content: flex-start;
      margin-right: 8px;
    }

    .set-score {
      background-color: #4b0082;
      color: white;
      padding: 14px 18px;
      border-radius: 8px 0 0 8px;
      font-size: 1.6rem;
      min-width: 42px;
      text-align: center;
      border-right: 1px solid #fff;
    }

    .set-score:last-child {
      border-radius: 0 8px 8px 0;
      border-right: none;
    }

    .game-score-container {
      display: flex;
      align-items: center;
      min-width: 70px;
      justify-content: flex-start;
      color: #006400;
      font-weight: bold;
      font-size: 1.8rem;
      margin-right: 12px;
      position: relative;
    }

    .game-score {
      min-width: 42px;
      text-align: center;
    }

    #serveButton {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 2rem;
      color: #006400;
      user-select: none;
      width: 28px;
      height: 28px;
      line-height: 28px;
      text-align: center;
      padding: 0;
      margin-left: 10px;
    }

 /* ğŸ”™ ÎšÎ¿Ï…Î¼Ï€Î¯ Î Î¯ÏƒÏ‰ ÏƒÏ„Î·Î½ Î‘ÏÏ‡Î¹ÎºÎ® */
.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  background: linear-gradient(145deg, #05ee10, #008000);
  color: #121212;
  border: none;
  border-radius: 50px;
  padding: 19px 29px;
  font-size: 1.7rem;
  font-weight: bold;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(5,238,16,0.6);
  transition: all 0.3s ease;
  z-index: 1000;
}

.back-button:hover {
  background: linear-gradient(145deg, #05ee10, #32cd32);
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(5,238,16,0.8);
}

.back-button:active {
  transform: scale(0.95);
}

/* ğŸ“Š ÎšÎ¿Ï…Î¼Ï€Î¯ Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½ */
#statsButton {
  position: fixed;
  top: 20px;
  right: 20px;
   background: linear-gradient(145deg, #05ee10, #008000);
  color: #121212;
  border: none;
  border-radius: 50px;
  padding: 12px 22px;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(5,238,16,0.6);
  transition: all 0.3s ease;
  z-index: 1000;
}
#statsButton:hover {
 background: linear-gradient(145deg, #05ee10, #32cd32);
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(5,238,16,0.8);
}

#statsButton:active {
  transform: scale(0.95);
}

    .dual-action-container {
      display: flex;
      justify-content: space-between;
      margin: 40px auto 0;
      max-width: 850px;
      padding: 0 20px;
      gap: 20px;
    }

 /* Player column */
.player-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  background-color: #1f1f1f;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
  height: 100%;
  min-height: 1100px; /* Î¼ÎµÎ³Î¬Î»Î¿ ÏÏˆÎ¿Ï‚ Î³Î¹Î± demo */
  color: #fff;
  padding: 20px;
}

/* Container ÎºÎ¿Ï…Î¼Ï€Î¹ÏÎ½ Ï€Î¿Ï… Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÏŒÎ»Î¿ Ï„Î¿ player-column */
.button-container {
  display: flex;
  flex-direction: column;
  flex-grow: 1;             /* Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÏŒÎ»Î¿ Ï„Î¿ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ ÏÏˆÎ¿Ï‚ */
  gap: 20px;                /* Î¼Î¹ÎºÏÏŒ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î± Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ */
}

/* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ Ï€Î¿Ï… Î¼Î¿Î¹ÏÎ¬Î¶Î¿Î½Ï„Î±Î¹ Ï„Î¿ ÏÏˆÎ¿Ï‚ Î¹ÏƒÎ¿Î¼ÎµÏÏÏ‚ */
.button-container .action-btn {
  background: linear-gradient(145deg, #05ee10, #008000);
  color: #121212;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  font-size: 2.4rem;
  font-weight: bold;
  width: 100%;
  flex-grow: 1;             /* â†‘ Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÏŒÏƒÎ¿ ÏÏˆÎ¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ */
  padding: 0;               /* Ï„Î¿ flex-grow ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ ÏÏˆÎ¿Ï‚ */
  transition: all 0.3s ease;
  box-shadow: 0 5px 14px rgba(5,238,16,0.7);
  text-transform: uppercase;
  letter-spacing: 1.2px;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.button-container .action-btn:hover {
  background: linear-gradient(145deg, #05ee10, #32cd32);
  transform: scale(1.03);
  box-shadow: 0 6px 16px rgba(5,238,16,0.8);
}

.button-container .action-btn:active {
  transform: scale(0.97);
  box-shadow: inset 0 3px 6px rgba(0,0,0,0.4);
  background: linear-gradient(145deg, #05ee10, #32cd32);

}


    .serve-ball {
      background: transparent;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      margin-left: 4px;
    }
    


/* Responsive */
@media (max-width: 480px) {
    .game-score-history {
        flex: 1 1 100%;
        text-align: center;
        font-size: 0.85em;
    }
}

.player-name-wrapper h3 {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: #05ee10;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 30px;
    text-shadow: 0 2px 6px rgba(0,0,0,0.6);
    transition: color 0.3s, transform 0.3s;
}

.player-name-wrapper h3:hover {
    color: #32cd32;
    transform: scale(1.05);
    cursor: default;
}
/* ÎšÎ¿Î¹Î½ÏŒ ÏƒÏ„Ï…Î» Î³Î¹Î± ÏŒÎ»Î± Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Ï€Î¬Î½Ï‰ Î´ÎµÎ¾Î¹Î¬ */
.stats-save-button {
  position: fixed;
  top: 20px;
  background: linear-gradient(145deg, #05ee10, #008000);
  color: #121212;
  border: none;
  border-radius: 50px;
  padding: 19px 32px;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(5,238,16,0.6);
  transition: all 0.3s ease;
  z-index: 1000;
 
}

.stats-save-button:hover {
  background: linear-gradient(145deg, #05ee10, #32cd32);
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(5,238,16,0.8);
}

.stats-save-button:active {
  transform: scale(0.95);
}

/* Î˜Î­ÏƒÎ· Ï„Ï‰Î½ ÎºÎ¿Ï…Î¼Ï€Î¹ÏÎ½ Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î±, Î¼Î¹ÎºÏÏŒ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î± */
#gameHistoryButton {
  right: 320px; /* Ï€Î¹Î¿ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ */
  top: 20px;

}

#saveMatchButton {
  right: 160px; /* Ï€Î¹Î¿ ÎºÎ¿Î½Ï„Î¬ ÏƒÏ„Î¿ Stats */
  top: 20px;
}

#statsButton {
  right: 20px;
  top: 20px;
}


/* ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î® Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Î´ÎµÎ¾Î¹Î¬ Î® Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬ */


/* ÎŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ (Ï€ÏÏÏ„Î¿ fault) */
.fault-active {
  background: linear-gradient(145deg, #ff0000, #cc0000) !important;
  color: #ffffff !important;
  box-shadow: 0 4px 12px rgba(255,0,0,0.6) !important;
  transform: scale(1.02) !important;
}
.fault-active:hover {
  background: linear-gradient(145deg, #ff4d4d, #ff0000) !important;
  transform: scale(1.05) !important;
}
.fault-active:active {
  background: linear-gradient(145deg, #990000, #cc0000) !important;
  transform: scale(1.05) !important;
  box-shadow: inset 0 3px 6px rgba(0,0,0,0.4) !important;
}
#saveMatchButton {
  position: fixed;
  top: 20px;
  right: 160px; /* ğŸ‘‰ Ï„Î¿ Ï†Î­ÏÎ½ÎµÎ¹ Î´Î¯Ï€Î»Î± ÏƒÏ„Î¿ Stats button */
  background: linear-gradient(145deg, #05ee10, #008000);
  color: #121212;
  border: none;
  border-radius: 50px;
  padding: 12px 22px;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(5,238,16,0.6);
  transition: all 0.3s ease;
  z-index: 1000;
}

#saveMatchButton:hover {
  background: linear-gradient(145deg, #05ee10, #32cd32);
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(5,238,16,0.8);
}

#saveMatchButton:active {
  transform: scale(0.95);
}
#topButtonsContainer {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 10px; /* Î¼Î¹ÎºÏÎ® Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Î¼ÎµÏ„Î±Î¾Ï ÎºÎ¿Ï…Î¼Ï€Î¹ÏÎ½ */
  z-index: 1000;
}

#topButtonsContainer .stats-save-button {
  position: static; /* Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ fixed Î±Ï†Î¿Ï Î¿ container ÎµÎ¯Î½Î±Î¹ fixed */
}







.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 50, 0, 0.85); /* ÏƒÎºÎ¿Ï„ÎµÎ¹Î½ÏŒ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ overlay */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}

/* Save button ÏƒÏ„Î¿ modal */
.modal .save-btn {
  background: linear-gradient(145deg, #32cd32, #7fff00); /* Wimbledon Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ gradient */
  color: #ffffff; /* ÏƒÎºÎ¿ÏÏÎ¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î³Î¹Î± contrast */
  border: 2px solid #ffffff;
  border-radius: 16px;
  padding: 28px 46px;
  font-size: 1.8rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modal .save-btn:hover {
  background: linear-gradient(145deg, #7fff00, #32cd32); /* Î±Î½Ï„Î¹ÏƒÏ„ÏÎ¿Ï†Î® gradient */
  color: #ffffff;
  transform: scale(1.05);
}

.modal .save-btn:active {
  background: linear-gradient(145deg, #228b22, #32cd32);
  transform: scale(0.97);
}

/* Cancel button ÏƒÏ„Î¿ modal */
.modal .cancel-btn {
  background: #b80404; /* ÎºÎ¯Ï„ÏÎ¹Î½Î¿ ÏƒÎ±Î½ Î¼Ï€Î¬Î»Î± Ï„Î­Î½Î¹Ï‚ */
  color: #ffffff;
  border: 2px solid #ffffff;
  border-radius: 16px;
  padding: 28px 46px;
  font-size: 1.8rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modal .cancel-btn:hover {
  background: #ff0000; /* Ï€Î¹Î¿ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ */
  transform: scale(1.05);
  color: white;
}

.modal .cancel-btn:active {
  background: #ff0000; /* Î­Î½Ï„Î¿Î½Î¿ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ Î³Î¹Î± active */
  transform: scale(0.97);
}
/* Î¤Î¯Ï„Î»Î¿Ï‚ modal */
.modal-content h2 {
 font-size: 3em;
}

/* ÎšÎµÎ¯Î¼ÎµÎ½Î¿ modal */
.modal-content p {
  font-size: 2.2rem;
 
}












/* Î Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿, ÏÏƒÏ„Îµ Î½Î± Ï…Ï€ÎµÏÎ¹ÏƒÏ‡ÏÏƒÎµÎ¹ Ï„Î¿Ï… Î³ÎµÎ½Î¹ÎºÎ¿Ï .modal-content */
/* ÎÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„ÏŒ style Î³Î¹Î± winner modal */
/* ğŸ“¦ Winner Modal (Dark Theme) */
.winner-modal-content {
  background: black;
  padding: 50px 60px;
  border-radius: 20px;
  text-align: center;
  min-width: 400px;
  max-width: 600px;
  
  color: #ffffff;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Î¤Î¯Ï„Î»Î¿Ï‚ */
.winner-modal-content h2 {
  margin-bottom: 25px;
  font-size: 3rem;
  font-weight: bold;
  color: #05ee10; /* Î­Î½Ï„Î¿Î½Î¿ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ Î³Î¹Î± Î½Î± Î¾ÎµÏ‡Ï‰ÏÎ¯Î¶ÎµÎ¹ */
  text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
}

/* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚ Î½Î¹ÎºÎ·Ï„Î® */
.winner-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 25px;
}

.winner-player-btn {
  padding: 20px 45px;
  font-size: 1.4rem;
  font-weight: bold;
  border-radius: 12px;
  border: 2px solid #32cd32;
  cursor: pointer;
  background: #006400; /* ÏƒÎºÎ¿ÏÏÎ¿ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ ÏŒÏ€Ï‰Ï‚ Ï„Î± player names */
  color: #ffffff;
  transition: all 0.2s ease;
}

.winner-player-btn:hover {
  background: #05ee10;
  color: #121212;
  transform: scale(1.05);
}

.winner-player-btn:active {
  background: #32cd32;
  color: #121212;
  transform: scale(0.97);
}

.winner-player-btn.selected {
  box-shadow: 0 0 15px #32cd32;
}

/* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ Cancel / Save */
.winner-actions {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.winner-cancel-btn,
.winner-save-btn {
  padding: 15px 35px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 12px;
  cursor: pointer;
  border: 2px solid;
  transition: all 0.2s ease;
}

.winner-cancel-btn {
  background: #8b0000; /* ÏƒÎºÎ¿ÏÏÎ¿ ÎºÏŒÎºÎºÎ¹Î½Î¿, consistent Î¼Îµ fault buttons */
  color: #ffffff;
  border-color: #ff4d4d;
}

.winner-cancel-btn:hover {
  background: #ff4d4d;
  transform: scale(1.03);
}

.winner-cancel-btn:active {
  background: #cc0000;
  transform: scale(0.97);
}

.winner-save-btn {
  background: #05ee10; /* Î­Î½Ï„Î¿Î½Î¿ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ */
  color: #121212;
  border-color: #32cd32;
}

.winner-save-btn:hover {
  background: #32cd32;
  transform: scale(1.03);
}

.winner-save-btn:active {
  background: #008000;
  transform: scale(0.97);
}


</style>
</head>
<body>
<a href="pregame.html" class="back-button">  â† Back</a>
  <div id="tournamentInfo"></div>
  <div id="courtImage"></div>
  <div id="wimbledonScoreboard" class="scoreboard"></div>

  <div id="actionButtonsContainer" class="dual-action-container">
      <div class="player-column" id="player1-column">
        <div class="player-name-wrapper">
          <h3 id="player1-name">Î Î‘Î™ÎšÎ¤Î—Î£ 1</h3>
        </div>
        <div class="button-container" id="player1-buttons"></div>
      </div>

      <div class="player-column" id="player2-column">
        <div class="player-name-wrapper">
          <h3 id="player2-name">Î Î‘Î™ÎšÎ¤Î—Î£ 2</h3>
        </div>
        <div class="button-container" id="player2-buttons"></div>
      </div>
  </div>

  <!-- ğŸ“Œ Game History ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¹Ï‚ player-columns -->
  

<div id="topButtonsContainer">
  <button id="gameHistoryButton" class="stats-save-button">Game History</button>
   <button id="statsButton" class="stats-save-button">Statistics</button>
  <button id="saveMatchButton" class="stats-save-button">Save Match</button>
 
  

</div>


<!-- HTML -->
<div id="winnerModal" class="modal winner-modal" style="display:none;">
  <div class="winner-modal-content">
    <h2>Choose Winner</h2>
    <div class="winner-buttons">
      <button id="winnerPlayer1" class="winner-player-btn"></button>
      <button id="winnerPlayer2" class="winner-player-btn"></button>
    </div>
    <div class="winner-actions">
      <button id="cancelModal" class="winner-cancel-btn">Cancel</button>
      <button id="confirmModal" class="winner-save-btn">Save</button>
    </div>
  </div>
</div>













<!-- Modal HTML -->
<div id="backModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>Are you sure you want to leave?</h2>
    <p>If you leave your data will be lost </p>
    <button class="modal-player-btn cancel-btn" id="exitMatchBtn">Leave</button>
    <button class="modal-player-btn save-btn" id="pauseMatchBtn">Cancel</button>
    
  </div>
</div>

<script>
 


document.getElementById('statsButton').addEventListener('click', () => {
    window.location.href = 'stats.html';
});
document.getElementById('gameHistoryButton').addEventListener('click', () => {
    window.location.href = 'gamehistory.html';
});

function updateCourtImage(type) {
    const court = document.getElementById('courtImage');
    if (type === 'blue') {
      court.style.backgroundImage = 'url("hard.jpg")';
    } else if (type === 'clay') {
      court.style.backgroundImage = 'url("clay.jpg")';
    } else {
      court.style.backgroundImage = 'url("grass.jpg")';
    }
}

let servePosition = localStorage.getItem('servePosition') || 'top';
let statsPlayer1 = JSON.parse(localStorage.getItem('statsPlayer1')) || {};
let statsPlayer2 = JSON.parse(localStorage.getItem('statsPlayer2')) || {};





function initializeMatch(matchData) {
    if (!matchData.scores) matchData.scores = { player1: [0], player2: [0] };
    if (matchData.currentSet == null) matchData.currentSet = 0;
    if (!matchData.currentGameScore) matchData.currentGameScore = { player1: '0', player2: '0' };
    if (!matchData.gameHistory) matchData.gameHistory = [[]];
    if (!matchData.inTiebreak) matchData.inTiebreak = false;
}

function resetCurrentGameScore(matchData) {
    matchData.currentGameScore = { player1: '0', player2: '0' };
}

function finishTiebreak(matchData, winner) {
    const setIndex = matchData.currentSet;

    if (winner === 'player1') {
        matchData.scores.player1[setIndex] = 7;
        matchData.scores.player2[setIndex] = 6;
    } else {
        matchData.scores.player1[setIndex] = 6;
        matchData.scores.player2[setIndex] = 7;
    }

    matchData.currentSet++;
    matchData.inTiebreak = false;
    matchData.tiebreakScore = { player1: 0, player2: 0 };
    matchData.scores.player1[matchData.currentSet] = 0;
    matchData.scores.player2[matchData.currentSet] = 0;

    resetCurrentGameScore(matchData);

    // ÎÎ­Î¿ game history Î³Î¹Î± Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ ÏƒÎµÏ„
    matchData.gameHistory[matchData.currentSet] = [];
}


function winGame(playerKey, matchData) {
    initializeMatch(matchData);
    const setIndex = matchData.currentSet;

    if (!matchData.inTiebreak) {
        matchData.scores[playerKey][setIndex]++;
        const pGames = matchData.scores.player1[setIndex];
        const oGames = matchData.scores.player2[setIndex];

        if (pGames === 6 && oGames === 6) {
            matchData.inTiebreak = true;
            matchData.tiebreakScore = { player1: 0, player2: 0 };
            resetCurrentGameScore(matchData);
        } else if ((pGames >= 6 || oGames >= 6) && Math.abs(pGames - oGames) >= 2) {
            matchData.currentSet++;
            matchData.inTiebreak = false;
            matchData.tiebreakScore = { player1: 0, player2: 0 };
            matchData.scores.player1[matchData.currentSet] = 0;
            matchData.scores.player2[matchData.currentSet] = 0;
            resetCurrentGameScore(matchData);

            // Î½Î­Î¿ ÏƒÎµÏ„ â†’ Ï†Ï„Î¹Î¬Ï‡Î½Î¿Ï…Î¼Îµ Î½Î­Î¿ array gameHistory
            matchData.gameHistory[matchData.currentSet] = [];
        }
    } else {
        const tP = matchData.tiebreakScore.player1;
        const tO = matchData.tiebreakScore.player2;
        if ((tP >= 7 && tP - tO >= 2) || (tO >= 7 && tO - tP >= 2)) {
            finishTiebreak(matchData, playerKey);
        }
    }

    resetCurrentGameScore(matchData);

    // ğŸ”‘ ÎšÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ Î­Î½Î± game â†’ Î¾ÎµÎºÎ¹Î½Î¬Î¼Îµ Î½Î­Î¿
    if (matchData.currentSet === setIndex) {
        matchData.gameHistory[setIndex].push([]);
    }

    servePosition = servePosition === 'top' ? 'bottom' : 'top';
    localStorage.setItem('servePosition', servePosition);

    localStorage.setItem('currentMatch', JSON.stringify(matchData));
    renderScoreboard(matchData);
    
}




function addPointTo(playerKey, matchData) {
    initializeMatch(matchData);
    const otherPlayer = playerKey === 'player1' ? 'player2' : 'player1';
    const setIndex = matchData.currentSet;

    if (!matchData.gameHistory[setIndex]) matchData.gameHistory[setIndex] = [];

    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Î½Î­Î¿ array Î¼ÏŒÎ½Î¿ Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î½Î­Î½Î± game ÏƒÏ„Î¿ ÏƒÎµÏ„
    if (matchData.gameHistory[setIndex].length === 0) {
        matchData.gameHistory[setIndex].push([]);
    }

    const currentGameHistory = matchData.gameHistory[setIndex][matchData.gameHistory[setIndex].length - 1];

    if (matchData.inTiebreak) {
        matchData.currentGameScore[playerKey] = String(Number(matchData.currentGameScore[playerKey] || 0) + 1);
        const pPoints = Number(matchData.currentGameScore.player1);
        const oPoints = Number(matchData.currentGameScore.player2);

        currentGameHistory.push(`${pPoints}-${oPoints}`);

        if ((pPoints >= 7 && pPoints - oPoints >= 2) || (oPoints >= 7 && oPoints - pPoints >= 2)) {
            finishTiebreak(matchData, playerKey);
            // ÎœÎµÏ„Î¬ Ï„Î¿ finishTiebreak, Ï„Î¿ reset Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î½Î­Î¿ array ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ addPointTo
        }
    } else {
        const scoreMap = ['0','15','30','40'];
        let pScore = matchData.currentGameScore[playerKey];
        let oScore = matchData.currentGameScore[otherPlayer];

        if (pScore === 'Ad') {
            winGame(playerKey, matchData);
            // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Î½Î­Î¿ array Î³Î¹Î± Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ game
            matchData.gameHistory[setIndex].push([]);
        } else if (oScore === 'Ad') {
            matchData.currentGameScore[playerKey] = '40';
            matchData.currentGameScore[otherPlayer] = '40';
            currentGameHistory.push(`${matchData.currentGameScore.player1}-${matchData.currentGameScore.player2}`);
        } else if (pScore === '40' && oScore === '40') {
            matchData.currentGameScore[playerKey] = 'Ad';
            currentGameHistory.push(`${matchData.currentGameScore.player1}-${matchData.currentGameScore.player2}`);
        } else {
            let idx = scoreMap.indexOf(pScore);
            if (idx < scoreMap.length - 1) {
                matchData.currentGameScore[playerKey] = scoreMap[idx + 1];
                currentGameHistory.push(`${matchData.currentGameScore.player1}-${matchData.currentGameScore.player2}`);
            } else {
                winGame(playerKey, matchData);
                if (matchData.currentSet === setIndex) {
                matchData.gameHistory[setIndex].push([]);
         }
            }
        }
    }

    localStorage.setItem('currentMatch', JSON.stringify(matchData));
    renderScoreboard(matchData);
    
}












  function renderScoreboard(matchData) {
    const container = document.getElementById('wimbledonScoreboard');
    container.innerHTML = '';

    const sets = 3; // Ï€Î¬Î½Ï„Î± 3 ÏƒÎµÏ„ Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·

    // --- Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î±Ï†Î±Î¯ÏÎµÏƒÎ· Ï„ÏŒÎ½Ï‰Î½ ---
    function removeGreekTones(str) {
        return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }

    // --- Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± ÎµÏ€Î¯Î¸ÎµÏ„Î¿ ÏƒÎµ ÎºÎµÏ†Î±Î»Î±Î¯Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï„ÏŒÎ½Î¿Ï…Ï‚ ---
    function getLastNameUpperNoTones(fullName) {
        const parts = fullName.trim().split(' ');
        const lastName = parts[parts.length - 1]; // Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ Î¼Î­ÏÎ¿Ï‚ Ï‰Ï‚ ÎµÏ€Î¯Î¸ÎµÏ„Î¿
        return removeGreekTones(lastName).toUpperCase();
    }

    const player1 = getLastNameUpperNoTones(matchData.player1);
    const player2 = getLastNameUpperNoTones(matchData.player2);

    document.getElementById('player1-name').textContent = player1;
    document.getElementById('player2-name').textContent = player2;

    // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ scores, Î³ÎµÎ¼Î¯Î¶Î¿Ï…Î¼Îµ Î¼Îµ 0 ÎºÎ±Î¹ Ï€Î¬Î½Ï„Î± 3 ÏƒÎµÏ„
    const scores1 = matchData.scores?.player1 || [];
    const scores2 = matchData.scores?.player2 || [];
    while (scores1.length < sets) scores1.push(0);
    while (scores2.length < sets) scores2.push(0);

    const currentGameScore = matchData.currentGameScore || { player1: '0', player2: '0' };
    const serveState = JSON.parse(localStorage.getItem('serveState')) || { player1: { pendingFault: false }, player2: { pendingFault: false } };

    const createPlayerRow = (name, scores, gameScore, isServing, playerKey) => {
        const row = document.createElement('div');
        row.className = 'scoreboard-row';

        const nameDiv = document.createElement('div');
        nameDiv.className = 'player-name';
        nameDiv.textContent = name;
        row.appendChild(nameDiv);

        const setsContainer = document.createElement('div');
        setsContainer.className = 'sets-container';
        scores.forEach(score => {
            const scoreBox = document.createElement('div');
            scoreBox.className = 'set-score';
            scoreBox.textContent = score;
            setsContainer.appendChild(scoreBox);
        });
        row.appendChild(setsContainer);

        const gameScoreContainer = document.createElement('div');
        gameScoreContainer.className = 'game-score-container';

        const gameScoreDiv = document.createElement('div');
        gameScoreDiv.className = 'game-score';
        gameScoreDiv.textContent = gameScore;
        gameScoreContainer.appendChild(gameScoreDiv);

        if (isServing) {
            const serveButton1 = document.createElement('button');
            serveButton1.id = `serveButton1-${playerKey}`;
            serveButton1.className = 'serve-ball';
            serveButton1.textContent = 'ğŸ¾';
            serveButton1.title = 'Î‘Î»Î»Î±Î³Î® ÏƒÎµÏÎ²Î¯Ï‚';
            serveButton1.onclick = () => {
                servePosition = servePosition === 'top' ? 'bottom' : 'top';
                renderScoreboard(matchData);
                renderActionButtons();
            };

            const serveButton2 = document.createElement('button');
            serveButton2.id = `serveButton2-${playerKey}`;
            serveButton2.className = 'serve-ball extra';
            serveButton2.textContent = 'ğŸ¾';
            serveButton2.title = 'Î”ÎµÏÏ„ÎµÏÎ¿ Î¼Ï€Î±Î»Î¬ÎºÎ¹';
            serveButton2.style.display = 'inline';

            if (serveState[playerKey] && serveState[playerKey].pendingFault) {
                serveButton2.style.display = 'none';
            }

            gameScoreContainer.appendChild(serveButton1);
            gameScoreContainer.appendChild(serveButton2);
        }

        row.appendChild(gameScoreContainer);
        return row;
    };

    const row1 = createPlayerRow(player1, scores1, currentGameScore.player1, servePosition === 'top', 'player1');
    const row2 = createPlayerRow(player2, scores2, currentGameScore.player2, servePosition === 'bottom', 'player2');

    container.appendChild(row1);
    container.appendChild(row2);

    renderActionButtons();
    
}


 function renderActionButtons() {
    const player1Btns = document.getElementById('player1-buttons');
    const player2Btns = document.getElementById('player2-buttons');

    // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ matchData
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || { player1: '', player2: '' };

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Î±Ï†Î±Î¯ÏÎµÏƒÎ· Ï„ÏŒÎ½Ï‰Î½
    function removeGreekTones(str) {
        return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± ÎµÏ€Î¯Î¸ÎµÏ„Î¿ ÏƒÎµ ÎºÎµÏ†Î±Î»Î±Î¯Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï„ÏŒÎ½Î¿Ï…Ï‚
    function getLastNameUpperNoTones(fullName) {
        const parts = fullName.trim().split(' ');
        const lastName = parts[parts.length - 1] || fullName;
        return removeGreekTones(lastName).toUpperCase();
    }

    const p1Name = getLastNameUpperNoTones(matchData.player1 || 'Î Î‘Î™ÎšÎ¤Î—Î£ 1');
    const p2Name = getLastNameUpperNoTones(matchData.player2 || 'Î Î‘Î™ÎšÎ¤Î—Î£ 2');

    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ ÏƒÏ„Î± player columns
    document.getElementById('player1-name').textContent = p1Name;
    document.getElementById('player2-name').textContent = p2Name;

    // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Ï‰Î½ ÎºÎ¿Ï…Î¼Ï€Î¹ÏÎ½
    player1Btns.innerHTML = '';
    player2Btns.innerHTML = '';

    const serveActions = ['Ace', 'Ball In', 'Fault'];
    const returnActions = ['Return Winner', 'Return Error'];
    const extraActions = ['Winner', 'Unforced Error', 'Forced Error'];

    // Î’Î¬Î¶Î¿Ï…Î¼Îµ/Î´Î¹Î±Î²Î¬Î¶Î¿Ï…Î¼Îµ global serveState (ÏƒÏ„Î¿ localStorage Î³Î¹Î± persistence)
    const defaultServeState = { player1: { pendingFault: false }, player2: { pendingFault: false } };
    const serveState = JSON.parse(localStorage.getItem('serveState')) || defaultServeState;

    const createButton = (action, playerLabel, container, group) => {
      const btn = document.createElement('button');
      btn.className = 'action-btn';
      btn.textContent = action;
      btn.dataset.group = group;
      btn.dataset.action = action;

      // Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¹Î¶Î¿Ï…Î¼Îµ playerKey Î±Ï€ÏŒ container id
      const playerKey = container.id === 'player1-buttons' ? 'player1' : 'player2';
      btn.dataset.playerKey = playerKey;

      // Î±ÏÏ‡Î¹ÎºÎ® ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·: Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ pending fault Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½
      if (action === 'Fault' && serveState[playerKey] && serveState[playerKey].pendingFault) {
        btn.style.backgroundColor = 'red';
        btn.textContent = 'Double Fault';
        btn.classList.add('fault-active');
      }
if (action === 'Ace') {
  btn.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    const playerKey = btn.dataset.playerKey;
    const statsKey = playerKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
    let stats = JSON.parse(localStorage.getItem(statsKey)) || {};

    // Î‘ÏÎ¾Î·ÏƒÎ· Î†ÏƒÏƒÏ‰Î½
    stats['Î†ÏƒÎ¿Î¹'] = (stats['Î†ÏƒÎ¿Î¹'] || 0) + 1;

    // Î‘ÏÎ¾Î·ÏƒÎ· ÎÎ¹ÎºÎ·Ï„ÏÎ½
    stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] = (stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] || 0) + 1;

    // Î‘ÏÎ¾Î·ÏƒÎ· ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î ÏŒÎ½Ï„Ï‰Î½
    stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

    // Î‘ÏÎ¾Î·ÏƒÎ· Î ÏŒÎ½Ï„Ï‰Î½ Î¼Îµ Î£ÎµÏÎ²Î¯Ï‚
    stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;

    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Ï€ÏÏÏ„Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚
    const serveState = JSON.parse(localStorage.getItem('serveState')) || {};
    if (!serveState[playerKey]) serveState[playerKey] = { pendingFault: false };

    if (!serveState[playerKey].pendingFault) {
      stats.firstServeNumerator = (stats.firstServeNumerator || 0) + 1;
      stats.firstServeDenominator = (stats.firstServeDenominator || 0) + 1;
    } else {
      serveState[playerKey].pendingFault = false;
      localStorage.setItem('serveState', JSON.stringify(serveState));
    }

    // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€Î¿ÏƒÎ¿ÏƒÏ„Î¿Ï 1Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚
    const num = stats.firstServeNumerator || 0;
    const denom = stats.firstServeDenominator || 0;
    const percent = denom > 0 ? Math.round((num / denom) * 100) : 0;
    stats['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ 1Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚'] = `${num}/${denom} (${percent}%)`;

    localStorage.setItem(statsKey, JSON.stringify(stats));

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏŒÎ½Ï„Î¿Ï…
    addPointTo(playerKey, matchData);

    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· UI
    renderScoreboard(matchData);
    renderActionButtons();
  });
}


    if (action === 'Fault') {
  btn.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    const playerKey = btn.dataset.playerKey;
    const statsKey = playerKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
    let stats = JSON.parse(localStorage.getItem(statsKey)) || {};

    // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
    stats.firstServeNumerator = stats.firstServeNumerator || 0;
    stats.firstServeDenominator = stats.firstServeDenominator || 0;
    stats['ÎÏ„Î±Î¼Ï€Î» Ï†Î¿Î»Ï„'] = stats['ÎÏ„Î±Î¼Ï€Î» Ï†Î¿Î»Ï„'] || 0;

    const serveState = JSON.parse(localStorage.getItem('serveState')) || {};
    if (!serveState[playerKey]) serveState[playerKey] = { pendingFault: false };

    if (!serveState[playerKey].pendingFault) {
      // Î ÏÏÏ„Î¿ fault â†’ Î¼ÏŒÎ½Î¿ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï€ÏÏÏ„Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚
      serveState[playerKey].pendingFault = true;
      stats.firstServeDenominator += 1;

      const num = stats.firstServeNumerator;
      const denom = stats.firstServeDenominator;
      const percent = denom > 0 ? Math.round((num / denom) * 100) : 0;
      stats['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ 1Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚'] = `${num}/${denom} (${percent}%)`;

      localStorage.setItem(statsKey, JSON.stringify(stats));
      localStorage.setItem('serveState', JSON.stringify(serveState));

      renderScoreboard(matchData);
      renderActionButtons();

    } else {
      // Î”ÎµÏÏ„ÎµÏÎ¿ fault â†’ Double Fault
      stats['ÎÏ„Î±Î¼Ï€Î» Ï†Î¿Î»Ï„'] += 1;
      stats['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] = (stats['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] || 0) + 1;

      const opponentKey = playerKey === 'player1' ? 'player2' : 'player1';
      const opponentStatsKey = opponentKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
      let opponentStats = JSON.parse(localStorage.getItem(opponentStatsKey)) || {};

      // Î‘Ï…Î¾Î¬Î½Î¿Ï…Î¼Îµ Î ÏŒÎ½Ï„Î¿Ï…Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚ ÎºÎ±Î¹ ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Ï€ÏŒÎ½Ï„Î¿Ï…Ï‚ Î³Î¹Î± Ï„Î¿Î½ Î±Î½Ï„Î¯Ï€Î±Î»Î¿
      opponentStats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (opponentStats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
      opponentStats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (opponentStats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

      localStorage.setItem(statsKey, JSON.stringify(stats));
      localStorage.setItem(opponentStatsKey, JSON.stringify(opponentStats));

      addPointTo(opponentKey, matchData);

      serveState[playerKey].pendingFault = false;
      localStorage.setItem('serveState', JSON.stringify(serveState));

      renderScoreboard(matchData);
      renderActionButtons();
    }
  });

  container.appendChild(btn);
  return;
}



if (action === 'Ball In') {
  btn.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    const statsKey = playerKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
    let stats = JSON.parse(localStorage.getItem(statsKey)) || {};

    stats.firstServeNumerator = stats.firstServeNumerator || 0;
    stats.firstServeDenominator = stats.firstServeDenominator || 0;

    const curServeState = JSON.parse(localStorage.getItem('serveState')) || defaultServeState;

    if (curServeState[playerKey] && curServeState[playerKey].pendingFault) {
      curServeState[playerKey].pendingFault = false;
      localStorage.setItem('serveState', JSON.stringify(curServeState));

      // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Fault
      const faultBtn = container.querySelector('[data-action="Fault"]');
      if (faultBtn) {
        faultBtn.style.backgroundColor = '#006400';
        faultBtn.textContent = 'Fault';
        faultBtn.classList.remove('fault-active');
      }

      // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î´ÎµÏÏ„ÎµÏÎ¿Ï… Î¼Ï€Î±Î»Î±ÎºÎ¹Î¿Ï
      const sb2 = document.getElementById(`serveButton2-${playerKey}`);
      if (sb2) sb2.style.display = 'inline';

    } else {
      stats.firstServeNumerator += 1;
      stats.firstServeDenominator += 1;

      const num = stats.firstServeNumerator;
      const denom = stats.firstServeDenominator;
      const percent = denom > 0 ? Math.round((num / denom) * 100) : 0;
      stats['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ 1Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚'] = `(${num}/${denom}) ${percent}%`;

      localStorage.setItem(statsKey, JSON.stringify(stats));
    }

    toggleActionGroups(false, 'main');
    toggleActionGroups(true, 'extra');
  });

  container.appendChild(btn);
  return;
}


if (action === 'Return Error' || action === 'Return Winner') {
  btn.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    const playerKey = btn.dataset.playerKey; // Î¿ Ï€Î±Î¯ÎºÏ„Î·Ï‚ Ï€Î¿Ï… Ï€Î±Ï„Î¬ÎµÎ¹ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯
    const opponentKey = playerKey === 'player1' ? 'player2' : 'player1';

    // stats Ï„Î¿Ï… Ï€Î±Î¯ÎºÏ„Î· Ï€Î¿Ï… Ï€Î±Ï„Î¬ÎµÎ¹ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯
    const statsKey = playerKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
    let stats = JSON.parse(localStorage.getItem(statsKey)) || {};

    // stats Ï„Î¿Ï… Î±Î½Ï„Î¯Ï€Î±Î»Î¿Ï…
    const opponentStatsKey = opponentKey === 'player1' ? 'statsPlayer1' : 'statsPlayer2';
    let opponentStats = JSON.parse(localStorage.getItem(opponentStatsKey)) || {};

    // serve state
    const serveState = JSON.parse(localStorage.getItem('serveState')) || {};
    if (!serveState[opponentKey]) serveState[opponentKey] = { pendingFault: false };

    // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Ï€ÏÏÏ„Î¿ ÏƒÎµÏÎ²Î¯Ï‚ (Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ Fault)
    if (!serveState[opponentKey].pendingFault) {
      opponentStats.firstServeDenominator = (opponentStats.firstServeDenominator || 0) + 1;
      opponentStats.firstServeNumerator = (opponentStats.firstServeNumerator || 0) + 1;

      const num = opponentStats.firstServeNumerator;
      const denom = opponentStats.firstServeDenominator;
      const percent = denom > 0 ? Math.round((num / denom) * 100) : 0;
      opponentStats['Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ 1Î¿Ï… ÏƒÎµÏÎ²Î¯Ï‚'] = `${num}/${denom} (${percent}%)`;

      localStorage.setItem(opponentStatsKey, JSON.stringify(opponentStats));
    }

    if (action === 'Return Winner') {
      // Î±Ï…Î¾Î¬Î½ÎµÎ¹ stats Ï„Î¿Ï… Ï€Î±Î¯ÎºÏ„Î·
      stats['Return Winners'] = (stats['Return Winners'] || 0) + 1;
      stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] = (stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] || 0) + 1;
      stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
      stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

      addPointTo(playerKey, matchData);
    } else if (action === 'Return Error') {
      // Î±Ï…Î¾Î¬Î½ÎµÎ¹ stats Ï„Î¿Ï… Î±Î½Ï„Î¯Ï€Î±Î»Î¿Ï…
      stats['Return Errors'] = (stats['Return Errors'] || 0) + 1;
      stats['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] = (stats['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] || 0) + 1;
      opponentStats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (opponentStats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
      opponentStats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (opponentStats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

      addPointTo(opponentKey, matchData);
    }

    localStorage.setItem(statsKey, JSON.stringify(stats));
    localStorage.setItem(opponentStatsKey, JSON.stringify(opponentStats));
    localStorage.setItem('currentMatch', JSON.stringify(matchData));
    localStorage.setItem('serveState', JSON.stringify(serveState));

    resetFaultButtons();
    renderScoreboard(matchData);
    renderActionButtons();
  });
}



 // default click behaviour Î³Î¹Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±
      btn.addEventListener('click', () => {
        if (action === 'Ball In') {
          toggleActionGroups(false, 'main');
          toggleActionGroups(true, 'extra');
          
        }

        if (group === 'extra') {
          toggleActionGroups(true, 'main');
          toggleActionGroups(false, 'extra');
        }
      });
     

      container.appendChild(btn);
    };

    function toggleActionGroups(show, group) {
      const buttons = document.querySelectorAll(`[data-group]`);
      buttons.forEach(btn => {
        if (btn.dataset.group === group) {
          btn.style.display = show ? 'flex' : 'none';
        }
      });
    }

    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î±ÏƒÎ¹ÎºÏÎ½ ÎºÎ¿Ï…Î¼Ï€Î¹ÏÎ½ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î· Î¸Î­ÏƒÎ· ÏƒÎµÏÎ²Î¯Ï‚
    if (servePosition === 'top') {
      serveActions.forEach(action => createButton(action, p1Name, player1Btns, 'main'));
      returnActions.forEach(action => createButton(action, p2Name, player2Btns, 'main'));
    } else {
      serveActions.forEach(action => createButton(action, p2Name, player2Btns, 'main'));
      returnActions.forEach(action => createButton(action, p1Name, player1Btns, 'main'));
    }

    // extra actions (ÏƒÏÎ¶Î¿Î½Ï„Î±Î¹ ÎºÎ±Î¹ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Î´ÏÎ¿ Ï€Î±Î¯ÎºÏ„ÎµÏ‚)
   // extra actions (Winner, Unforced Error, Forced Error)
extraActions.forEach(action => {
  // --- ÎšÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Player1 ---
  const btn1 = document.createElement('button');
  btn1.className = 'action-btn';
  btn1.textContent = action;
  btn1.dataset.group = 'extra';
  btn1.dataset.action = action;
  btn1.dataset.playerKey = 'player1';
  btn1.style.display = 'none';

 if (action === 'Winner') {
  btn1.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    let stats = JSON.parse(localStorage.getItem('statsPlayer1')) || {};

    // Î‘ÏÎ¾Î·ÏƒÎ· Î½Î¹ÎºÎ·Ï„ÏÎ½ ÎºÎ±Î¹ ÎºÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Ï€ÏŒÎ½Ï„Ï‰Î½ Ï€Î¬Î½Ï„Î±
    stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] = (stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] || 0) + 1;
    stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

    // Î‘Î½ ÏƒÎµÏÎ²Î¯ÏÎµÎ¹ Î¿ player2, Î±Ï…Î¾Î¬Î½Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î¿Î¹ Ï€ÏŒÎ½Ï„Î¿Î¹ (Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚)
    if (servePosition=='bottom') {
       stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
 if (servePosition=='top')  {
       stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
    localStorage.setItem('statsPlayer1', JSON.stringify(stats));

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏŒÎ½Ï„Î¿Ï… ÏƒÏ„Î¿Î½ Ï€Î±Î¯ÎºÏ„Î·1 ÏƒÏ„Î¿ matchData
    addPointTo('player1', matchData);
    localStorage.setItem('currentMatch', JSON.stringify(matchData));

    renderScoreboard(matchData);
    renderActionButtons();
  });
}



  if (action === 'Unforced Error' || action === 'Forced Error') {
  btn1.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    let stats1 = JSON.parse(localStorage.getItem('statsPlayer1')) || {};
    let stats2 = JSON.parse(localStorage.getItem('statsPlayer2')) || {};

    // Î‘ÏÎ¾Î·ÏƒÎ· Î»Î±Î¸ÏÎ½ Î³Î¹Î± Player1
    if (action === 'Unforced Error') {
      stats1['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] = (stats1['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] || 0) + 1;
    } else if (action === 'Forced Error') {
      stats1['Î›Î¬Î¸Î· Ï…Ï€ÏŒ Ï€Î¯ÎµÏƒÎ·'] = (stats1['Î›Î¬Î¸Î· Ï…Ï€ÏŒ Ï€Î¯ÎµÏƒÎ·'] || 0) + 1;
    }

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏŒÎ½Ï„Î¿Ï… ÏƒÏ„Î¿Î½ Î±Î½Ï„Î¯Ï€Î±Î»Î¿
   

    // Î‘ÏÎ¾Î·ÏƒÎ· "ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î ÏŒÎ½Ï„Ï‰Î½" Î³Î¹Î± Player2
    stats2['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats2['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

    // Î‘ÏÎ¾Î·ÏƒÎ· Ï€ÏŒÎ½Ï„Ï‰Î½ Î¼Îµ/Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ Ï€Î¿Î¹Î¿Ï‚ ÏƒÎµÏÎ²Î¯ÏÎµÎ¹
    if (servePosition === 'bottom') {
      stats2['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats2['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    } else if (servePosition === 'top') {
      stats2['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats2['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
addPointTo('player2', matchData)
    // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
    localStorage.setItem('statsPlayer1', JSON.stringify(stats1));
    localStorage.setItem('statsPlayer2', JSON.stringify(stats2));
    localStorage.setItem('currentMatch', JSON.stringify(matchData));

    renderScoreboard(matchData);
    renderActionButtons();
  });
}



  player1Btns.appendChild(btn1);

  // --- ÎšÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Player2 ---
  const btn2 = document.createElement('button');
  btn2.className = 'action-btn';
  btn2.textContent = action;
  btn2.dataset.group = 'extra';
  btn2.dataset.action = action;
  btn2.dataset.playerKey = 'player2';
  btn2.style.display = 'none';

  
if (action === 'Winner') {
  btn2.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    let stats = JSON.parse(localStorage.getItem('statsPlayer2')) || {};

    // Î‘ÏÎ¾Î·ÏƒÎ· Î½Î¹ÎºÎ·Ï„ÏÎ½ ÎºÎ±Î¹ ÎºÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Ï€ÏŒÎ½Ï„Ï‰Î½ Ï€Î¬Î½Ï„Î±
    stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] = (stats['ÎÎ¹ÎºÎ·Ï„Î­Ï‚'] || 0) + 1;
    stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

    // Î‘Î½ ÏƒÎµÏÎ²Î¯ÏÎµÎ¹ Î¿ player1, Î±Ï…Î¾Î¬Î½Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î¿Î¹ Ï€ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚
   if (servePosition=='top')  {
       stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
 if (servePosition=='bottom')  {
       stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
    localStorage.setItem('statsPlayer2', JSON.stringify(stats));

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏŒÎ½Ï„Î¿Ï… ÏƒÏ„Î¿Î½ player2 ÏƒÏ„Î¿ matchData
    addPointTo('player2', matchData);
    localStorage.setItem('currentMatch', JSON.stringify(matchData));

    renderScoreboard(matchData);
    renderActionButtons();
  });
}

if (action === 'Unforced Error' || action === 'Forced Error') {
  btn2.addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    let stats2 = JSON.parse(localStorage.getItem('statsPlayer2')) || {};
    let stats1 = JSON.parse(localStorage.getItem('statsPlayer1')) || {};

    // Î‘ÏÎ¾Î·ÏƒÎ· Î»Î±Î¸ÏÎ½ Î³Î¹Î± Player2
    if (action === 'Unforced Error') {
      stats2['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] = (stats2['Î‘Ï„Î¿Î¼Î¹ÎºÎ¬ Î»Î¬Î¸Î·'] || 0) + 1;
    } else if (action === 'Forced Error') {
      stats2['Î›Î¬Î¸Î· Ï…Ï€ÏŒ Ï€Î¯ÎµÏƒÎ·'] = (stats2['Î›Î¬Î¸Î· Ï…Ï€ÏŒ Ï€Î¯ÎµÏƒÎ·'] || 0) + 1;
    }

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏŒÎ½Ï„Î¿Ï… ÏƒÏ„Î¿Î½ Î±Î½Ï„Î¯Ï€Î±Î»Î¿
    

    // Î‘ÏÎ¾Î·ÏƒÎ· "ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î ÏŒÎ½Ï„Ï‰Î½" Î³Î¹Î± Player1
    stats1['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] = (stats1['ÎšÎµÏÎ´Î¹ÏƒÎ¼Î­Î½Î¿Î¹ Î ÏŒÎ½Ï„Î¿Î¹'] || 0) + 1;

    // Î‘ÏÎ¾Î·ÏƒÎ· Ï€ÏŒÎ½Ï„Ï‰Î½ Î¼Îµ/Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ Ï€Î¿Î¹Î¿Ï‚ ÏƒÎµÏÎ²Î¯ÏÎµÎ¹
    if (servePosition === 'top') {
      stats1['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats1['Î ÏŒÎ½Ï„Î¿Î¹ Î¼Îµ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    } else if (servePosition === 'bottom') {
      stats1['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] = (stats1['Î ÏŒÎ½Ï„Î¿Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÎµÏÎ²Î¯Ï‚'] || 0) + 1;
    }
addPointTo('player1', matchData);
    // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
    localStorage.setItem('statsPlayer2', JSON.stringify(stats2));
    localStorage.setItem('statsPlayer1', JSON.stringify(stats1));
    localStorage.setItem('currentMatch', JSON.stringify(matchData));

    renderScoreboard(matchData);
    renderActionButtons();
  });
}




  player2Btns.appendChild(btn2);
});

  }

  function toggleSecondBall(show = true) {
    const ball1 = document.getElementById('serveButton2-player1');
    const ball2 = document.getElementById('serveButton2-player2');
    if (ball1) ball1.style.display = show ? 'inline' : 'none';
    if (ball2) ball2.style.display = show ? 'inline' : 'none';
  }

  window.onload = () => {






    const matchData = JSON.parse(localStorage.getItem('currentMatch'));
    if (!matchData) {
      document.body.innerHTML = '<p style="color: red;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Î³ÏÎ½Î±.</p>';
      return;
    }
  servePosition = localStorage.getItem('servePosition') || 'top';
    document.getElementById('tournamentInfo').innerHTML = `
     
      <p style="color: #fff; font-size: 1.5rem; font-weight: 500; text-shadow: 0 1px 2px #000; margin-top:100px">
        ğŸ“ ${matchData.location} | ğŸ—“ ${matchData.date} | ğŸ•’ ${matchData.time}
      </p>
    `;

    updateCourtImage(matchData.rules.courtType);
    renderScoreboard(matchData);
  };
  function updateStat(playerKey, category, isWon = true) {
  let stats = JSON.parse(localStorage.getItem(playerKey)) || createEmptyStats();
  stats = normalizeStats(stats);

  // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î¼ÎµÏ„ÏÎ·Ï„Î®Ï‚ "won/total"
  if (stats[category] && typeof stats[category] === "object") {
    if (isWon) stats[category].won++;
    stats[category].total++;
  } else {
    // Î‘Ï€Î»Î® Î±ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÎ® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± (Ï€.Ï‡. Î†ÏƒÎ¿Î¹)
    stats[category] = (Number(stats[category]) || 0) + 1;
  }

  localStorage.setItem(playerKey, JSON.stringify(stats));
  loadStats(); // Î±Î½Î±Î½Î­Ï‰ÏƒÎ· Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ±
}

function toggleServer() {
  const serveState = JSON.parse(localStorage.getItem('serveState')) || {};
  const current = serveState.currentServer || 'player1';
  const newServer = current === 'player1' ? 'player2' : 'player1';
  serveState.currentServer = newServer;
  serveState.servePosition = newServer === 'player1' ? 'top' : 'bottom';
  
  renderScoreboard(JSON.parse(localStorage.getItem('currentMatch')));
  localStorage.setItem('servePosition', servePosition);  // <--- Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·
}
document.getElementById('saveMatchButton').addEventListener('click', () => {
    const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
    const statsPlayer1 = JSON.parse(localStorage.getItem('statsPlayer1')) || {};
    const statsPlayer2 = JSON.parse(localStorage.getItem('statsPlayer2')) || {};

    if (!matchData.player1 || !matchData.player2) {
        alert('Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï€Î»Î®ÏÏ‰Ï‚ Î¿ Î±Î³ÏÎ½Î±Ï‚.');
        return;
    }

    const modal = document.getElementById('winnerModal');
    modal.style.display = 'flex';
    const player1Btn = document.getElementById('winnerPlayer1');
    const player2Btn = document.getElementById('winnerPlayer2');
    player1Btn.textContent = matchData.player1;
    player2Btn.textContent = matchData.player2;

    // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚
    let selectedWinner = null;

    // Î•Ï€Î¹Î»Î¿Î³Î® Î½Î¹ÎºÎ·Ï„Î®
    [player1Btn, player2Btn].forEach(btn => {
        btn.classList.remove('selected');
        btn.onclick = () => {
            selectedWinner = btn.textContent;
            player1Btn.classList.toggle('selected', selectedWinner === player1Btn.textContent);
            player2Btn.classList.toggle('selected', selectedWinner === player2Btn.textContent);
        };
    });

    // ÎšÎ¿Ï…Î¼Ï€Î¯ Î‘ÎºÏÏÏ‰ÏƒÎ·Ï‚
    document.getElementById('cancelModal').onclick = () => {
        selectedWinner = null;
        modal.style.display = 'none';
    };

    // ÎšÎ¿Ï…Î¼Ï€Î¯ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚
  document.getElementById('confirmModal').onclick = () => {
    if (!selectedWinner) return alert('Choose Winner First!');

    const loser = (selectedWinner === matchData.player1) ? matchData.player2 : matchData.player1;
    const savedMatch = {
        timestamp: new Date().toISOString(),
        players: { player1: matchData.player1, player2: matchData.player2 },
        winner: selectedWinner,
        loser: loser,
        date: matchData.date || null,
        location: matchData.location || null,
        scores: matchData.scores,
        gameHistory: matchData.gameHistory,
        stats: { player1: statsPlayer1, player2: statsPlayer2 }
    };

    const request = indexedDB.open("TennisMatchesDB", 1);
    request.onupgradeneeded = e => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains("matches")) {
            db.createObjectStore("matches", { keyPath: "id", autoIncrement: true });
        }
    };
    request.onsuccess = e => {
        const db = e.target.result;
        const tx = db.transaction("matches", "readwrite");
        tx.objectStore("matches").add(savedMatch);
        tx.oncomplete = () => {
            localStorage.removeItem('currentMatch');
            localStorage.removeItem('statsPlayer1');
            localStorage.removeItem('statsPlayer2');
            modal.style.display = 'none';
            // Î‘Î½Î±ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î· index.html
            window.location.href = 'index.html';
        };
        tx.onerror = () => alert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î¿Ï… Î±Î³ÏÎ½Î±.');
    };
    request.onerror = e => console.error("IndexedDB error:", e.target.errorCode);
};

});



 const backButton = document.querySelector('.back-button');
const modal = document.getElementById('backModal');
const pauseBtn = document.getElementById('pauseMatchBtn');
const exitBtn = document.getElementById('exitMatchBtn');

// ÎŒÏ„Î±Î½ Ï€Î±Ï„Î¹Î­Ï„Î±Î¹ Ï„Î¿ Back
backButton.addEventListener('click', function(e){
  e.preventDefault(); // Î‘Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ Î¬Î¼ÎµÏƒÎ· Î±Î»Î»Î±Î³Î® ÏƒÎµÎ»Î¯Î´Î±Ï‚
  modal.style.display = 'flex';
});

// Cancel â†’ ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÎ¹ Ï„Î¿Î½ Î±Î³ÏÎ½Î±
pauseBtn.addEventListener('click', function(){
  modal.style.display = 'none';
  // Î¤Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î±ÏÎ±Î¼Î­Î½Î¿Ï…Î½ ÏƒÏ„Î¿ localStorage
  // ÎŸ Î±Î³ÏÎ½Î±Ï‚ ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹
});

// Exit â†’ Î´Î¹Î±Î³ÏÎ¬Ï†ÎµÎ¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÎºÎ±Î¹ ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®
exitBtn.addEventListener('click', function(){
  localStorage.removeItem('currentMatch');
  localStorage.removeItem('statsPlayer1');
  localStorage.removeItem('statsPlayer2');
  modal.style.display = 'none';
  window.location.href = "index.html";
});

// ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ modal Î±Î½ ÎºÎ¬Î½ÎµÎ¹Ï‚ ÎºÎ»Î¹Îº Î­Î¾Ï‰ Î±Ï€ÏŒ Ï„Î¿ content
window.addEventListener('click', function(e){
  if(e.target == modal){
    modal.style.display = 'none';
  }
});



function resetFaultButtons() { //ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ± ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï… fault
  const serveState = JSON.parse(localStorage.getItem('serveState')) || {};
  serveState.player1.pendingFault = false;
  serveState.player2.pendingFault = false;
  localStorage.setItem('serveState', JSON.stringify(serveState));

  ['player1', 'player2'].forEach(playerKey => {
    const btn = document.querySelector(`#${playerKey}-buttons button[data-action="Fault"]`);
    if (btn) {
      btn.style.backgroundColor = 'green'; // Î±ÏÏ‡Î¹ÎºÏŒ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿
      btn.textContent = 'Fault';
      btn.classList.remove('fault-active');
    }
  });

  // Î‘Î½Î±Î½ÎµÏÎ½Î¿Ï…Î¼Îµ UI
  const matchData = JSON.parse(localStorage.getItem('currentMatch')) || {};
  renderScoreboard(matchData);
  renderActionButtons();
}

</script>

</body>
</html>

